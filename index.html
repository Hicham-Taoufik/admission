<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire d'Admission</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .container { width: 50%; margin: auto; }
        img { margin-top: 20px; max-width: 200px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Formulaire d'Admission</h2>
        <form id="admissionForm">
            <label>Nom et Pr√©nom:</label><br>
            <input type="text" id="name" required><br><br>

            <label>CIN:</label><br>
            <input type="text" id="cin" required><br><br>

            <label>Adresse:</label><br>
            <input type="text" id="address" required><br><br>

            <label>T√©l√©phone:</label><br>
            <input type="text" id="phone" required><br><br>

            <label>Date de Naissance:</label><br>
            <input type="date" id="dob" required><br><br>

            <button type="submit">Soumettre</button>
        </form>

        <div id="qrSection" class="hidden">
            <h3>QR Code du Patient</h3>
            <img id="qrCode" src="" alt="QR Code"><br>
            <button onclick="printQRCode()">üñ®Ô∏è Imprimer le QR Code</button>
        </div>
    </div>

    <script>
        document.getElementById("admissionForm").addEventListener("submit", function(event) {
            event.preventDefault(); // Prevent form refresh

            let name = document.getElementById("name").value;
            let cin = document.getElementById("cin").value;
            let address = document.getElementById("address").value;
            let phone = document.getElementById("phone").value;
            let dob = document.getElementById("dob").value;

            let patientData = {
                name: name,
                cin: cin,
                address: address,
                phone: phone,
                dob: dob
            };

            // Send data to n8n Webhook
            fetch("https://workflows.aphelionxinnovations.com/webhook-test/admission", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(patientData)
            })
            .then(response => response.json())
            .then(data => {
                // Generate QR Code
                let qrURL = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${cin}`;
                document.getElementById("qrCode").src = qrURL;
                document.getElementById("qrSection").classList.remove("hidden");
            })
            .catch(error => console.error("Erreur:", error));
        });

        function printQRCode() {
            let printWindow = window.open('', '', 'width=400,height=400');
            printWindow.document.write('<html><head><title>Imprimer QR Code</title></head><body>');
            printWindow.document.write('<h3>QR Code du Patient</h3>');
            printWindow.document.write('<img src="' + document.getElementById("qrCode").src + '">');
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        }
    </script>
</body>
</html>
