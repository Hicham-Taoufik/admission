<form id="admissionForm">
    <label>Nom:</label>
    <input type="text" id="nom" required>

    <label>Prénom:</label>
    <input type="text" id="prenom" required>

    <label>Numéro d'Identification (CIN):</label>
    <input type="text" id="cin">

    <label>Adresse:</label>
    <textarea id="address"></textarea>

    <label>Ville:</label>
    <input type="text" id="ville">

    <label>Téléphone:</label>
    <input type="text" id="phone" required>

    <label>Date de Naissance:</label>
    <input type="date" id="dob" required>

    <label>Sexe:</label>
    <select id="sexe">
        <option value="M">Masculin</option>
        <option value="F">Féminin</option>
    </select>

    <label>Avez-vous une mutuelle ?</label>
    <select id="mutuelle" onchange="toggleMutuelleField()">
        <option value="Non">Non</option>
        <option value="Oui">Oui</option>
    </select>

    <div id="mutuelleDiv" style="display: none;">
        <label>Nom de la Mutuelle:</label>
        <select id="mutuelle_nom">
            <option value="CNOPS">CNOPS</option>
            <option value="CNSS">CNSS</option>
            <option value="Autre">Autre</option>
        </select>
    </div>

    <label>Motif de Consultation:</label>
    <select id="consultation">
        <option value="Consultation">Consultation</option>
        <option value="Urgence">Urgence</option>
        <option value="Suivi Médical">Suivi Médical</option>
    </select>

    <button type="submit" class="btn btn-submit">✅ Soumettre</button>
</form>

<script>
    function toggleMutuelleField() {
        let mutuelleValue = document.getElementById("mutuelle").value;
        document.getElementById("mutuelleDiv").style.display = (mutuelleValue === "Oui") ? "block" : "none";
    }

    document.getElementById("admissionForm").addEventListener("submit", function(event) {
        event.preventDefault();
        
        const patientData = {
            nom: document.getElementById("nom").value,
            prenom: document.getElementById("prenom").value,
            cin: document.getElementById("cin").value,
            address: document.getElementById("address").value,
            ville: document.getElementById("ville").value,
            phone: document.getElementById("phone").value,
            dob: document.getElementById("dob").value,
            sexe: document.getElementById("sexe").value,
            mutuelle: document.getElementById("mutuelle").value,
            mutuelle_nom: document.getElementById("mutuelle_nom").value || null,
            consultation: document.getElementById("consultation").value
        };

        fetch("https://workflows.aphelionxinnovations.com/webhook-test/admission", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(patientData)
        })
        .then(response => response.json())
        .then(data => {
            alert("✅ Patient enregistré avec succès !");
            document.getElementById("admissionForm").reset();
            document.getElementById("mutuelleDiv").style.display = "none";
        })
        .catch(error => {
            console.error("❌ Erreur:", error);
            alert("❌ Échec de l'enregistrement du patient.");
        });
    });
</script>
